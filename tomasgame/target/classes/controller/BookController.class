// Source code is decompiled from a .class file using FernFlower decompiler (from Intellij IDEA).
package controller;

import dao.MarineLifeDAO;
import dao.UserCatchDAO;
import java.awt.Component;
import java.io.File;
import java.io.IOException;
import java.net.URL;
import java.util.HashSet;
import java.util.List;
import java.util.ResourceBundle;
import java.util.Set;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.control.Alert;
import javafx.scene.control.Button;
import javafx.scene.control.TextArea;
import javafx.scene.control.Alert.AlertType;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.input.MouseEvent;
import javafx.scene.layout.AnchorPane;
import javafx.scene.media.Media;
import javafx.scene.media.MediaPlayer;
import javafx.stage.Stage;
import javax.swing.JOptionPane;
import model.MarineLife;
import model.User;

public class BookController implements Initializable {
   @FXML
   private Button ikan1Button;
   @FXML
   private Button ikan2Button;
   @FXML
   private Button ikan3Button;
   @FXML
   private Button ikan4Button;
   @FXML
   private Button ikan5Button;
   @FXML
   private Button ikan6Button;
   @FXML
   private Button ikan7Button;
   @FXML
   private Button ikan8Button;
   @FXML
   private Button ikan9Button;
   @FXML
   private Button backButton;
   @FXML
   private AnchorPane gamePane1;
   @FXML
   private AnchorPane gamePane2;
   @FXML
   private AnchorPane gamePane3;
   @FXML
   private AnchorPane gamePane4;
   @FXML
   private AnchorPane gamePane5;
   @FXML
   private AnchorPane gamePane6;
   @FXML
   private AnchorPane gamePane7;
   @FXML
   private AnchorPane gamePane8;
   @FXML
   private AnchorPane gamePane9;
   @FXML
   private ImageView ikan1ImageView;
   @FXML
   private ImageView ikan2ImageView;
   @FXML
   private ImageView ikan3ImageView;
   @FXML
   private ImageView ikan4ImageView;
   @FXML
   private ImageView ikan5ImageView;
   @FXML
   private ImageView ikan6ImageView;
   @FXML
   private ImageView ikan7ImageView;
   @FXML
   private ImageView ikan8ImageView;
   @FXML
   private ImageView ikan9ImageView;
   private List<MarineLife> marineLifeList;
   private Set<Integer> caughtMarineLifeIds;
   private User currentUser;
   private static final String QUESTION_MARK_PATH = "src/main/java/assets/question.png";
   private MediaPlayer mediaPlayer;

   public BookController() {
   }

   public void initialize(URL url, ResourceBundle resourceBundle) {
      this.currentUser = LoginController.user;
      if (this.currentUser == null) {
         this.showErrorDialog("Please login first!");
         this.handleBack((MouseEvent)null);
      } else {
         try {
            this.marineLifeList = MarineLifeDAO.getAllMarineLife();
            this.loadUserCatch();
            AnchorPane[] panes = new AnchorPane[]{this.gamePane1, this.gamePane2, this.gamePane3, this.gamePane4, this.gamePane5, this.gamePane6, this.gamePane7, this.gamePane8, this.gamePane9};

            for(int i = 0; i < panes.length && i < this.marineLifeList.size(); ++i) {
               this.initializeFishDisplay(panes[i], i);
            }

            this.playBackgroundMusic();
         } catch (Exception var5) {
            this.showErrorDialog("Failed to load marine life data: " + var5.getMessage());
            var5.printStackTrace();
         }

      }
   }

   private void loadUserCatch() {
      if (this.currentUser != null) {
         int userId = this.currentUser.getUid();
         this.caughtMarineLifeIds = UserCatchDAO.getUserCatchIds(userId);
      } else {
         this.caughtMarineLifeIds = new HashSet();
      }

   }

   private void initializeFishDisplay(AnchorPane pane, int index) {
      if (index >= 0 && index < this.marineLifeList.size()) {
         MarineLife marineLife = (MarineLife)this.marineLifeList.get(index);
         boolean isCaught = this.caughtMarineLifeIds.contains(marineLife.getId());
         ImageView targetImageView = (ImageView)pane.getChildren().stream().filter((node) -> {
            return node instanceof ImageView;
         }).findFirst().orElse((Object)null);
         if (targetImageView != null) {
            if (isCaught) {
               this.initializeStaticFish(pane, index);
            } else {
               this.initializeQuestionMark(targetImageView);
            }
         }
      }

   }

   private void initializeStaticFish(AnchorPane pane, int index) {
      if (index >= 0 && index < this.marineLifeList.size()) {
         MarineLife marineLife = (MarineLife)this.marineLifeList.get(index);
         ImageView sprite = marineLife.getSprite();
         if (sprite != null) {
            ImageView targetImageView = (ImageView)pane.getChildren().stream().filter((node) -> {
               return node instanceof ImageView;
            }).findFirst().orElse((Object)null);
            if (targetImageView != null) {
               sprite.setPreserveRatio(true);
               sprite.setFitWidth(targetImageView.getFitWidth());
               sprite.setFitHeight(targetImageView.getFitHeight());
               double offsetX = 40.0;
               double offsetY = 10.0;
               sprite.setLayoutX(targetImageView.getLayoutX() + offsetX);
               sprite.setLayoutY(targetImageView.getLayoutY() + offsetY);
               pane.getChildren().remove(targetImageView);
               pane.getChildren().add(sprite);
               marineLife.startAnimation();
               targetImageView.layoutBoundsProperty().addListener((obs, oldBounds, newBounds) -> {
                  sprite.setFitWidth(newBounds.getWidth());
                  sprite.setFitHeight(newBounds.getHeight());
                  sprite.setLayoutX(newBounds.getMinX() + offsetX);
                  sprite.setLayoutY(newBounds.getMinY() + offsetY);
               });
            }
         }
      }

   }

   private void initializeQuestionMark(ImageView targetImageView) {
      try {
         File questionMarkFile = new File("src/main/java/assets/question.png");
         if (!questionMarkFile.exists()) {
            System.err.println("Question mark image not found at: " + questionMarkFile.getAbsolutePath());
            return;
         }

         Image questionMarkImage = new Image(questionMarkFile.toURI().toString());
         targetImageView.setImage(questionMarkImage);
         targetImageView.setPreserveRatio(true);
         double offsetX = 40.0;
         double offsetY = 10.0;
         targetImageView.setLayoutX(targetImageView.getLayoutX() + offsetX);
         targetImageView.setLayoutY(targetImageView.getLayoutY() + offsetY);
         targetImageView.layoutBoundsProperty().addListener((obs, oldBounds, newBounds) -> {
            targetImageView.setFitWidth(newBounds.getWidth());
            targetImageView.setFitHeight(newBounds.getHeight());
            targetImageView.setLayoutX(newBounds.getMinX() + offsetX);
            targetImageView.setLayoutY(newBounds.getMinY() + offsetY);
         });
      } catch (Exception var8) {
         System.err.println("Error loading question mark image: " + var8.getMessage());
         var8.printStackTrace();
      }

   }

   @FXML
   private void handleMarineLifeButton(MouseEvent event) {
      if (this.currentUser == null) {
         this.showErrorDialog("Please login first!");
      } else {
         Button source = (Button)event.getSource();
         int index = Integer.parseInt(source.getId().replaceAll("[^0-9]", "")) - 1;
         if (this.marineLifeList != null && index >= 0 && index < this.marineLifeList.size()) {
            MarineLife marineLife = (MarineLife)this.marineLifeList.get(index);
            if (!this.caughtMarineLifeIds.contains(marineLife.getId())) {
               this.showErrorDialog("You haven't caught this fish yet.");
            } else {
               this.showMarineLifeInfo(index);
            }

         } else {
            this.showErrorDialog("Invalid fish index.");
         }
      }
   }

   private void showMarineLifeInfo(int index) {
      if (this.marineLifeList != null && index >= 0 && index < this.marineLifeList.size()) {
         MarineLife marineLife = (MarineLife)this.marineLifeList.get(index);
         Alert infoAlert = new Alert(AlertType.INFORMATION);
         infoAlert.setTitle("Fish Information");
         infoAlert.setHeaderText("Details of " + marineLife.getName());
         String var10002 = marineLife.getName();
         TextArea textArea = new TextArea("Name: " + var10002 + "\n\nClassification: " + marineLife.getClassification() + "\n\nPoints: " + marineLife.getPoints() + "\n\nDescription: " + marineLife.getDescription());
         textArea.setEditable(false);
         textArea.setWrapText(true);
         textArea.setPrefRowCount(10);
         textArea.setPrefColumnCount(40);
         infoAlert.getDialogPane().setContent(textArea);
         infoAlert.showAndWait();
      } else {
         this.showErrorDialog("Marine life data is not available.");
      }
   }

   @FXML
   private void handleBack(MouseEvent event) {
      try {
         this.stopBackgroundMusic();
         URL url = (new File("src/main/java/view/MainMenu.fxml")).toURI().toURL();
         Parent root = (Parent)FXMLLoader.load(url);
         Stage stage = (Stage)this.backButton.getScene().getWindow();
         stage.setScene(new Scene(root));
         stage.show();
      } catch (IOException var5) {
         var5.printStackTrace();
         JOptionPane.showMessageDialog((Component)null, "Failed to load Main Menu!");
      }

   }

   private void showErrorDialog(String message) {
      Alert alert = new Alert(AlertType.ERROR);
      alert.setTitle("Error");
      alert.setHeaderText((String)null);
      alert.setContentText(message);
      alert.showAndWait();
   }

   private void playBackgroundMusic() {
      try {
         String musicPath = "src/main/java/assets/Books.mp3";
         Media media = new Media((new File(musicPath)).toURI().toString());
         this.mediaPlayer = new MediaPlayer(media);
         this.mediaPlayer.setCycleCount(-1);
         this.mediaPlayer.play();
      } catch (Exception var3) {
         System.err.println("Error playing background music: " + var3.getMessage());
      }

   }

   private void stopBackgroundMusic() {
      if (this.mediaPlayer != null) {
         this.mediaPlayer.stop();
      }

   }
}

