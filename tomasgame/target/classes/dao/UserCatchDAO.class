// Source code is decompiled from a .class file using FernFlower decompiler (from Intellij IDEA).
package dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;
import model.MarineLife;

public class UserCatchDAO {
   public UserCatchDAO() {
   }

   public static void addUserCatch(int userId, int marineLifeId) {
      try {
         Throwable var2 = null;
         Object var3 = null;

         try {
            Connection con = BaseDAO.getCon();

            try {
               String checkQuery = "SELECT COUNT(*) FROM user_catch WHERE id_user = ? AND id_marinelife = ?";
               Throwable var6 = null;
               Throwable var7 = null;

               PreparedStatement checkStmt;
               try {
                  checkStmt = con.prepareStatement(checkQuery);

                  try {
                     checkStmt.setInt(1, userId);
                     checkStmt.setInt(2, marineLifeId);
                     ResultSet rs = checkStmt.executeQuery();
                     if (rs.next() && rs.getInt(1) > 0) {
                        System.out.println("Data already exists. Skipping insert.");
                        return;
                     }
                  } finally {
                     if (checkStmt != null) {
                        checkStmt.close();
                     }

                  }
               } catch (Throwable var55) {
                  if (var6 == null) {
                     var6 = var55;
                  } else if (var6 != var55) {
                     var6.addSuppressed(var55);
                  }

                  throw var6;
               }

               String insertQuery = "INSERT INTO user_catch (id_user, id_marinelife) VALUES (?, ?)";
               var7 = null;
               checkStmt = null;

               try {
                  PreparedStatement insertStmt = con.prepareStatement(insertQuery);

                  try {
                     insertStmt.setInt(1, userId);
                     insertStmt.setInt(2, marineLifeId);
                     insertStmt.executeUpdate();
                     System.out.println("Data inserted successfully.");
                  } finally {
                     if (insertStmt != null) {
                        insertStmt.close();
                     }

                  }
               } catch (Throwable var53) {
                  if (var7 == null) {
                     var7 = var53;
                  } else if (var7 != var53) {
                     var7.addSuppressed(var53);
                  }

                  throw var7;
               }
            } finally {
               if (con != null) {
                  con.close();
               }

            }
         } catch (Throwable var57) {
            if (var2 == null) {
               var2 = var57;
            } else if (var2 != var57) {
               var2.addSuppressed(var57);
            }

            throw var2;
         }
      } catch (SQLException var58) {
         System.err.println("Error while adding user catch: " + var58.getMessage());
         var58.printStackTrace();
      }
   }

   public static List<MarineLife> getUserCatchBook(int userId) {
      List<MarineLife> marineLifeList = new ArrayList();
      String query = "SELECT id_marinelife FROM user_catch WHERE id_user = ?";

      try {
         Throwable var3 = null;
         Object var4 = null;

         try {
            Connection con = BaseDAO.getCon();

            try {
               PreparedStatement statement = con.prepareStatement(query);

               try {
                  statement.setInt(1, userId);
                  ResultSet resultSet = statement.executeQuery();

                  while(resultSet.next()) {
                     MarineLife marineLife = MarineLifeDAO.getMarineLifeById(resultSet.getInt("id_marinelife"));
                     if (marineLife != null) {
                        marineLifeList.add(marineLife);
                     }
                  }
               } finally {
                  if (statement != null) {
                     statement.close();
                  }

               }
            } catch (Throwable var22) {
               if (var3 == null) {
                  var3 = var22;
               } else if (var3 != var22) {
                  var3.addSuppressed(var22);
               }

               if (con != null) {
                  con.close();
               }

               throw var3;
            }

            if (con != null) {
               con.close();
            }
         } catch (Throwable var23) {
            if (var3 == null) {
               var3 = var23;
            } else if (var3 != var23) {
               var3.addSuppressed(var23);
            }

            throw var3;
         }
      } catch (SQLException var24) {
         System.err.println("Error fetching user catch book: " + var24.getMessage());
         var24.printStackTrace();
      }

      return marineLifeList;
   }

   public static Set<Integer> getUserCatchIds(int userId) {
      Set<Integer> marineLifeIds = new HashSet();
      String query = "SELECT id_marinelife FROM user_catch WHERE id_user = ?";

      try {
         Throwable var3 = null;
         Object var4 = null;

         try {
            Connection con = BaseDAO.getCon();

            try {
               PreparedStatement statement = con.prepareStatement(query);

               try {
                  statement.setInt(1, userId);
                  ResultSet resultSet = statement.executeQuery();

                  while(resultSet.next()) {
                     marineLifeIds.add(resultSet.getInt("id_marinelife"));
                  }
               } finally {
                  if (statement != null) {
                     statement.close();
                  }

               }
            } catch (Throwable var21) {
               if (var3 == null) {
                  var3 = var21;
               } else if (var3 != var21) {
                  var3.addSuppressed(var21);
               }

               if (con != null) {
                  con.close();
               }

               throw var3;
            }

            if (con != null) {
               con.close();
            }
         } catch (Throwable var22) {
            if (var3 == null) {
               var3 = var22;
            } else if (var3 != var22) {
               var3.addSuppressed(var22);
            }

            throw var3;
         }
      } catch (SQLException var23) {
         System.err.println("Error fetching user catch IDs: " + var23.getMessage());
         var23.printStackTrace();
      }

      return marineLifeIds;
   }
}

